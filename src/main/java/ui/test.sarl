package ui
import io.sarl.core.Initialize
import javafx.application.Platform
import io.sarl.core.Lifecycle
import io.sarl.core.DefaultContextInteractions
import io.sarl.core.Logging

import environment.Environment
import events.*
import ui.GUI
import java.io.FileWriter
import java.io.IOException

agent test{
	uses DefaultContextInteractions, Lifecycle, Logging
	
	var gui : GUI
	var width = 30
	var height = 30
	var nbHumans = 1
	var nbZombies = 1
	var nbWalls = 1
	var nbWeapons = 1
	
	var nb = 100
	var i = 1
	
	var file = new FileWriter("Info.csv")
		
	on Initialize {
		gui = GUI.GUI

		Platform.runLater [
			gui.launchGUI
		]
		
		/*for(i : 1..<11){
			for(j : 1..<11){
				for(h : 0 ..< 10){
					end = false
					spawn(Environment, this.gui, this.width, this.height, i, j, 0, h)
					emit(new Launch)
					while(end == false){
						// Wait
					}
				}
			}
		}*/
		spawn(Environment, this.gui, this.width, this.height, this.nbHumans, this.nbZombies, this.nbWalls, this.nbWeapons)
		emit(new Launch)

		try {
			file.write(
				"nbHumans" + ";" + "nbZombies" + ";" + "nbWeapons" + ";" + "nbHumans remaining"+ ";" +
				"nbZombies remaining"+ ";" + "nbWeapons remaining" + ";" + "nbSteps" + ";" + "winner" + "\n")
		} catch (e : IOException) {
			info(e)
		}
	}
	
	on UpdateGUI{
		Platform.runLater [
			gui.setScene(occurrence.objects, occurrence.nbHumans, occurrence.nbZombies, occurrence.points, occurrence.nbSteps)
		]
	}
	
	on End{
		var winner : String
		if (occurrence.nbHumans == occurrence.nbZombies){
			winner = "Draw"
		}
		else if (occurrence.nbHumans > occurrence.nbZombies) {
			winner = "Humans"
		}
		else{
			winner = "Zombies"
		}
		try{
			this.file.write(this.nbHumans + ";" + this.nbZombies + ";" + this.nbWeapons + ";" + occurrence.nbHumans + ";" + occurrence.nbZombies + ";" + occurrence.nbWeapons + ";" +
				occurrence.nbSteps + ";" + winner + "\n")
			System.out.println("FINIIIII")
		} catch (e : IOException) {
			info(e)
		}
		emit(new KillEnvironment)
		if(this.i == this.nb){
			this.i = 1
			if(this.nbHumans < 2) {
				this.nbHumans ++
			}
			else if (this.nbZombies < 2) {
				this.nbZombies ++
				this.nbHumans = 1
			}
			else if(this.nbWeapons < 2) {
				this.nbWeapons ++
				this.nbZombies = 1
			}
			else {
				file.close
				killMe
			}
		}
		else {
			this.i ++
		}	
		
		spawn(Environment, this.gui, this.width, this.height, this.nbHumans, this.nbZombies, this.nbWalls,
			this.nbWeapons)
		emit(new Launch)
	}

}